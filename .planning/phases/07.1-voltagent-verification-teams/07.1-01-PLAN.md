---
phase: 07.1-voltagent-verification-teams
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - /Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md
  - /Users/matte/Documents/workspace/get-shit-done/get-shit-done/bin/gsd-tools.cjs
autonomous: true

must_haves:
  truths:
    - "Execute-phase orchestrator detects tasks requiring verification"
    - "Code-reviewer specialist spawns after task completion"
    - "Verification context includes task output and modified files"
    - "Verification results determine go/no-go for task completion"
    - "Failed verification blocks task and reports issues"
  artifacts:
    - path: "/Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md"
      provides: "Verification team spawning logic"
      contains: "spawn_verification_specialist"
    - path: "/Users/matte/Documents/workspace/get-shit-done/get-shit-done/bin/gsd-tools.cjs"
      provides: "Verification tier classification"
      exports: ["determine-verification-tier"]
  key_links:
    - from: "execute-phase.md"
      to: "Task tool"
      via: "spawn verification specialist"
      pattern: "Task.*subagent_type.*code-reviewer"
    - from: "verification result"
      to: "task completion decision"
      via: "go/no-go logic"
      pattern: "VERIFICATION_PASSED.*true"
---

<objective>
Implement core verification infrastructure in execute-phase orchestrator

Purpose: Enable quality gates through specialist verification after task completion
Output: Updated orchestrator that spawns code-reviewer for completed tasks
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-voltagent-verification-teams/07.1-RESEARCH.md
@/Users/matte/Documents/workspace/get-shit-done/.planning/available_agents.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add verification tier detection to gsd-tools</name>
  <files>/Users/matte/Documents/workspace/get-shit-done/get-shit-done/bin/gsd-tools.cjs</files>
  <action>
    Add a new command `determine-verification-tier` to gsd-tools.cjs that analyzes task characteristics and returns appropriate verification tier:

    - Parse task description and files for keywords: security, auth, payment, database → Tier 3
    - Check for API, business-logic, integration keywords → Tier 2
    - Default to Tier 1 for simple changes

    The command should accept task description and file list as arguments, returning JSON:
    ```json
    {
      "tier": 1,
      "reason": "Simple configuration change",
      "specialists": ["code-reviewer"]
    }
    ```

    Tier mapping:
    - Tier 1: ["code-reviewer"]
    - Tier 2: ["code-reviewer", "qa-expert"]
    - Tier 3: ["code-reviewer", "qa-expert", "principal-engineer"]

    Important: Make verification optional - if no specialists available, return tier 0 (skip verification).
  </action>
  <verify>node ~/.claude/get-shit-done/bin/gsd-tools.cjs determine-verification-tier "Add user authentication" "src/auth/login.ts" returns tier 3</verify>
  <done>Command returns appropriate tier based on task characteristics</done>
</task>

<task type="auto">
  <name>Task 2: Add verification spawning to execute-phase workflow</name>
  <files>/Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</files>
  <action>
    Update the execute-phase.md workflow to spawn verification specialists after task completion:

    1. After each task completes (in execute_waves step, after spot-check passes), add verification logic:
       - Call gsd-tools determine-verification-tier with task info
       - If tier > 0, spawn code-reviewer specialist
       - Pass verification context via files_to_read

    2. Add new step after spot-check in Wave completion (step 4):
       ```markdown
       **Verification (if tier > 0):**

       Determine verification tier:
       ```bash
       TIER_INFO=$(node ~/.claude/get-shit-done/bin/gsd-tools.cjs determine-verification-tier "{task_description}" "{modified_files}")
       TIER=$(echo "$TIER_INFO" | jq -r '.tier')
       ```

       If tier > 0, spawn code-reviewer:
       ```
       Task(
         subagent_type="code-reviewer",
         model="{verifier_model}",
         prompt="
           <objective>
           Review the implementation of {task_name} from plan {plan_id}.
           Verify code quality, security, patterns, and completeness.
           </objective>

           <files_to_read>
           - {phase_dir}/{plan_file} (Plan requirements)
           - {phase_dir}/{plan_id}-SUMMARY.md (What was built)
           - {modified_files} (Changed code to review)
           </files_to_read>

           <verification_focus>
           - Code follows project patterns
           - No security vulnerabilities
           - Error handling present
           - Tests included if applicable
           </verification_focus>

           Return structured result:
           - status: PASS/FAIL/WARNING
           - issues: list of problems found
           - suggestions: improvements (non-blocking)
         "
       )
       ```
       ```

    3. Process verification result:
       - If PASS: Continue to next task
       - If WARNING: Log warnings but continue
       - If FAIL: Report issues, ask user "Fix issues or continue?"

    4. Add graceful degradation:
       - If code-reviewer not available, log warning and skip verification
       - Check available_agents.md before spawning
  </action>
  <verify>grep -A 20 "spawn code-reviewer" /Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md shows verification logic</verify>
  <done>Execute-phase workflow spawns verification specialists after tasks complete</done>
</task>

<task type="auto">
  <name>Task 3: Add verification context generation</name>
  <files>/Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</files>
  <action>
    Enhance the verification spawning logic to generate focused context for verification specialists:

    1. Create verification brief generation before spawning specialist:
       ```markdown
       Generate verification brief:
       ```bash
       cat > /tmp/verification-brief.md << 'EOF'
       # Verification Brief

       ## Task: {task_name}
       **Plan:** {plan_id}
       **Type:** {task_type}
       **Tier:** {tier}

       ## What was built
       {task_objective_from_plan}

       ## Files modified
       {list_of_modified_files}

       ## Verification focus
       Based on Tier {tier}, focus on:
       - Tier 1: Code quality, patterns, obvious issues
       - Tier 2: + Test coverage, edge cases, error handling
       - Tier 3: + Security, performance, production readiness

       ## Success criteria from plan
       {done_criteria_from_task}
       EOF
       ```
       ```

    2. Include verification brief in files_to_read for specialist

    3. Parse verification result and make decision:
       ```markdown
       Parse result:
       ```bash
       VERIFICATION_STATUS=$(echo "$VERIFICATION_RESULT" | grep -o "status: [A-Z]*" | cut -d' ' -f2)
       VERIFICATION_ISSUES=$(echo "$VERIFICATION_RESULT" | sed -n '/issues:/,/suggestions:/p')
       ```

       Decision logic:
       - PASS → Mark task verified, continue
       - WARNING → Log warnings in SUMMARY, continue
       - FAIL → Block task, report issues to user
       ```

    4. Log verification results in task summary:
       - Add "Verification" section to SUMMARY.md
       - Record specialist used, status, any issues/warnings
  </action>
  <verify>grep "verification-brief.md" /Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md shows context generation</verify>
  <done>Verification specialists receive focused context and results are processed</done>
</task>

</tasks>

<verification>
- Execute-phase orchestrator calls determine-verification-tier after tasks
- Code-reviewer specialist spawns for tier > 0 tasks
- Verification results block failed tasks
- Graceful degradation when specialists unavailable
</verification>

<success_criteria>
- Verification tier determination working (test with sample tasks)
- Code-reviewer spawning after task completion
- Verification results parsed and decisions made
- Failed verifications block task progression
- Verification results logged to SUMMARY.md
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-voltagent-verification-teams/07.1-01-SUMMARY.md`
</output>