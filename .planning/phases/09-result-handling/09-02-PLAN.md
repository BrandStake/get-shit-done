---
phase: 09-result-handling
plan: 02
type: execute
wave: 2
depends_on: [09-01]
files_modified: [get-shit-done/workflows/execute-phase.md, get-shit-done/templates/summary.md]
autonomous: true

must_haves:
  truths:
    - "STATE.md updates go through gsd-tools exclusively"
    - "Specialist metadata tracked in SUMMARY.md frontmatter"
    - "Co-authored commits include specialist attribution"
  artifacts:
    - path: "get-shit-done/workflows/execute-phase.md"
      provides: "State updates via gsd-tools commands"
      contains: "gsd-tools.cjs state"
    - path: "get-shit-done/workflows/execute-phase.md"
      provides: "Specialist usage tracking in SUMMARY.md"
      contains: "specialist_usage:"
    - path: "get-shit-done/workflows/execute-phase.md"
      provides: "Co-authored commit generation"
      contains: "Co-Authored-By:"
  key_links:
    - from: "Task execution"
      to: "STATE.md"
      via: "gsd-tools state commands"
      pattern: "gsd-tools.cjs state"
    - from: "SPECIALISTS array"
      to: "SUMMARY.md frontmatter"
      via: "specialist_usage field"
      pattern: "specialist_usage:"
---

<objective>
Implement state management via gsd-tools and specialist attribution in commits and summaries.

Purpose: Preserve single-writer pattern for STATE.md, track which specialists executed which tasks, and ensure proper attribution in git history.
Output: State updates via gsd-tools, specialist metadata in SUMMARY.md, co-authored commits
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-result-handling/09-RESEARCH.md
@.planning/phases/09-result-handling/09-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add state updates via gsd-tools</name>
  <files>get-shit-done/workflows/execute-phase.md</files>
  <action>
    Add state update calls using gsd-tools after successful task execution.

    After successful task parsing (where TASK_STATUS="SUCCESS"):
    ```bash
    # Update state via gsd-tools
    if [ "$TASK_STATUS" = "SUCCESS" ]; then
      # Record task completion
      node ~/.claude/get-shit-done/bin/gsd-tools.cjs state record-metric \
        --phase "${PHASE}" \
        --plan "${PLAN}" \
        --task "${TASK_NUM}" \
        --specialist "${CURRENT_SPECIALIST}" \
        --duration "${TASK_DURATION}"

      # Add any decisions from specialist output
      if echo "$SPECIALIST_RESULT" | grep -q "Decision:"; then
        DECISION=$(echo "$SPECIALIST_RESULT" | grep "Decision:" | sed 's/.*Decision: //')
        node ~/.claude/get-shit-done/bin/gsd-tools.cjs state add-decision \
          --phase "${PHASE}" \
          --summary "${DECISION}" \
          --specialist "${CURRENT_SPECIALIST}"
      fi

      # Update progress
      node ~/.claude/get-shit-done/bin/gsd-tools.cjs state update-progress
    fi
    ```

    Based on research pattern from lines 202-219 of 09-RESEARCH.md.

    IMPORTANT: Never write directly to STATE.md. Always use gsd-tools commands to prevent corruption from concurrent writes.
  </action>
  <verify>grep -A 10 "gsd-tools.cjs state record-metric" get-shit-done/workflows/execute-phase.md</verify>
  <done>State updates use gsd-tools exclusively, no direct STATE.md writes</done>
</task>

<task type="auto">
  <name>Task 2: Track specialist metadata in SUMMARY generation</name>
  <files>get-shit-done/workflows/execute-phase.md</files>
  <action>
    Build specialist usage map during execution and include in SUMMARY.md generation.

    1. Track which specialist executed each task during wave execution:
    ```bash
    # Initialize tracking at wave start
    declare -A SPECIALIST_TASKS_MAP

    # After each task execution
    if [ -z "${SPECIALIST_TASKS_MAP[$CURRENT_SPECIALIST]}" ]; then
      SPECIALIST_TASKS_MAP[$CURRENT_SPECIALIST]="$TASK_NUM"
    else
      SPECIALIST_TASKS_MAP[$CURRENT_SPECIALIST]="${SPECIALIST_TASKS_MAP[$CURRENT_SPECIALIST]}, $TASK_NUM"
    fi
    ```

    2. When generating SUMMARY.md (in the Task() prompt that creates summary):
    ```bash
    # Build specialist_usage YAML for frontmatter
    SPECIALIST_USAGE_YAML="specialist_usage:"
    for SPEC in "${!SPECIALIST_TASKS_MAP[@]}"; do
      SPECIALIST_USAGE_YAML="${SPECIALIST_USAGE_YAML}
      ${SPEC}: [${SPECIALIST_TASKS_MAP[$SPEC]}]"
    done

    # Pass to summary generation prompt
    <specialist_metadata>
    ${SPECIALIST_USAGE_YAML}
    </specialist_metadata>
    ```

    3. Update the summary template reference to include specialist_usage in frontmatter.

    Based on research pattern from lines 221-240 of 09-RESEARCH.md.
  </action>
  <verify>grep -A 5 "SPECIALIST_TASKS_MAP" get-shit-done/workflows/execute-phase.md</verify>
  <done>Specialist usage tracked and included in SUMMARY.md frontmatter</done>
</task>

<task type="auto">
  <name>Task 3: Add co-authored commit attribution</name>
  <files>get-shit-done/workflows/execute-phase.md</files>
  <action>
    Include Co-Authored-By trailers when specialists execute tasks.

    When instructing specialists to commit (in the Task() prompt), add guidance:
    ```bash
    <commit_attribution>
    When committing, include co-authorship:

    git commit -m "$(cat <<'EOF'
    feat(${PHASE}-${PLAN}): [task description]

    [Implementation details]

    Co-Authored-By: ${CURRENT_SPECIALIST} <${CURRENT_SPECIALIST}@voltagent>
    EOF
    )"
    </commit_attribution>
    ```

    Also add to the execute-plan.md prompt template where commits are made.

    For gsd-executor (default specialist), use:
    - Co-Authored-By: gsd-executor <gsd@claude.team>

    For other specialists, use:
    - Co-Authored-By: [specialist-name] <[specialist-name]@voltagent>

    Based on research pattern from lines 242-259 of 09-RESEARCH.md.

    This ensures GitHub/GitLab properly display co-authorship in their UIs.
  </action>
  <verify>grep -B 2 -A 5 "Co-Authored-By:" get-shit-done/workflows/execute-phase.md | head -20</verify>
  <done>Commits include Co-Authored-By trailers with specialist attribution</done>
</task>

</tasks>

<verification>
- State updates use gsd-tools.cjs commands exclusively
- SPECIALIST_TASKS_MAP tracks task-to-specialist mapping
- SUMMARY.md includes specialist_usage in frontmatter
- Commits include Co-Authored-By trailers
- No direct writes to STATE.md
</verification>

<success_criteria>
- STATE.md never corrupted by concurrent writes
- Can trace which specialist executed which task
- Git history shows specialist co-authorship
- GitHub/GitLab display co-authors in UI
</success_criteria>

<output>
After completion, create `.planning/phases/09-result-handling/09-02-SUMMARY.md`
</output>