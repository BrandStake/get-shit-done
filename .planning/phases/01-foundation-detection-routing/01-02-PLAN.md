---
phase: 01-foundation-detection-routing
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [.planning/config.json, agents/gsd-executor.md]
autonomous: true
must_haves:
  truths:
    - "Config file has use_specialists setting"
    - "Feature flag controls delegation behavior"
    - "System defaults to false for backward compatibility"
  artifacts:
    - path: ".planning/config.json"
      provides: "Workflow settings for specialist usage"
      contains: "use_specialists"
    - path: "agents/gsd-executor.md"
      provides: "Config loading logic"
      contains: "load_config"
  key_links:
    - from: "config.json"
      to: "gsd-executor delegation logic"
      via: "workflow.use_specialists flag"
      pattern: "workflow\\.use_specialists"
---

<objective>
Add configuration support for specialist delegation with feature flag and fallback settings.

Purpose: Allow users to control delegation behavior through config.json while maintaining backward compatibility with existing v1.20 workflows.
Output: Updated config.json with specialist settings and config loading in gsd-executor.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-foundation-detection-routing/01-RESEARCH.md

# Current config structure
@.planning/config.json

# Executor to add config loading
@agents/gsd-executor.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update config.json schema</name>
  <files>.planning/config.json</files>
  <action>
Add specialist configuration to the existing config.json:

1. Under "workflow" section, add:
   - "use_specialists": false (default for v1.21, preserves backward compatibility)
   - Comment: "// Enable delegation to VoltAgent specialists when available"

2. Add new "voltagent" section with:
   - "fallback_on_error": true (gracefully handle specialist failures)
   - "max_delegation_depth": 1 (prevent delegation chains)
   - "complexity_threshold": {
       "min_files": 3,
       "min_lines": 50,
       "require_domain_match": true
     }
   - Comment: "// VoltAgent specialist delegation settings"

3. Preserve all existing settings unchanged.

Based on research: Default to false ensures zero impact on existing users. Settings can be enabled per-project as teams adopt VoltAgent.
  </action>
  <verify>grep -n "use_specialists" .planning/config.json</verify>
  <done>Config has use_specialists flag defaulted to false</done>
</task>

<task type="auto">
  <name>Task 2: Add config loading to gsd-executor</name>
  <files>agents/gsd-executor.md</files>
  <action>
In the `<step name="load_project_state">` section of gsd-executor.md, add config loading:

1. After loading STATE.md, add config loading:
   ```bash
   # Load specialist configuration
   USE_SPECIALISTS=$(cat .planning/config.json 2>/dev/null | grep -o '"use_specialists"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "false")
   FALLBACK_ON_ERROR=$(cat .planning/config.json 2>/dev/null | grep -o '"fallback_on_error"[[:space:]]*:[[:space:]]*[^,}]*' | grep -o 'true\|false' || echo "true")

   # Load complexity thresholds
   MIN_FILES=$(cat .planning/config.json 2>/dev/null | grep -o '"min_files"[[:space:]]*:[[:space:]]*[0-9]*' | grep -o '[0-9]*' || echo "3")
   MIN_LINES=$(cat .planning/config.json 2>/dev/null | grep -o '"min_lines"[[:space:]]*:[[:space:]]*[0-9]*' | grep -o '[0-9]*' || echo "50")
   ```

2. Store these in variables for use in delegation decisions.

3. Log configuration status:
   ```bash
   echo "Specialist delegation: ${USE_SPECIALISTS} (fallback: ${FALLBACK_ON_ERROR})"
   ```

4. Add early exit if specialists disabled:
   ```bash
   if [ "$USE_SPECIALISTS" = "false" ]; then
     DELEGATION_MODE="disabled"
   fi
   ```

This ensures backward compatibility - when use_specialists=false, delegation logic is completely bypassed.
  </action>
  <verify>grep -n "USE_SPECIALISTS" agents/gsd-executor.md</verify>
  <done>Config loading implemented with feature flag check</done>
</task>

<task type="auto">
  <name>Task 3: Add dynamic specialist registry population</name>
  <files>agents/gsd-executor.md</files>
  <action>
In the `<specialist_registry>` section, add dynamic population logic:

1. Create `populate_available_specialists()` function:
   ```bash
   populate_available_specialists() {
     # Check ~/.claude/agents/ for available specialists
     AVAILABLE_SPECIALISTS=""

     if [ -d ~/.claude/agents/ ]; then
       for agent in ~/.claude/agents/*.md; do
         if [ -f "$agent" ]; then
           SPECIALIST_NAME=$(basename "$agent" .md)
           # Filter for VoltAgent specialists (match known patterns)
           if echo "$SPECIALIST_NAME" | grep -E "(python|typescript|golang|rust|kubernetes|docker|postgres|security|terraform)" >/dev/null; then
             AVAILABLE_SPECIALISTS="$AVAILABLE_SPECIALISTS $SPECIALIST_NAME"
           fi
         done
       fi
     fi

     # Also check npm global packages for voltagent-* packages
     NPM_SPECIALISTS=$(npm list -g --depth=0 2>/dev/null | grep voltagent- || true)

     echo "Available specialists:$AVAILABLE_SPECIALISTS"
     echo "VoltAgent packages: $NPM_SPECIALISTS"
   }
   ```

2. Call this during initialization to build runtime registry.

3. Use the populated registry to validate specialist availability before delegation.

Based on research: Dynamic detection ensures system works with whatever specialists are installed, supporting all 127+ without hardcoding.
  </action>
  <verify>grep -n "populate_available_specialists" agents/gsd-executor.md</verify>
  <done>Dynamic specialist registry populates from filesystem and npm</done>
</task>

</tasks>

<verification>
- Config.json has use_specialists flag defaulted to false
- Config.json has voltagent section with fallback settings
- gsd-executor loads configuration on startup
- Dynamic registry detects available specialists
- Feature flag completely disables delegation when false
</verification>

<success_criteria>
- When use_specialists=false, gsd-executor behaves identically to v1.20
- Config loading extracts specialist settings correctly
- Dynamic registry finds specialists in ~/.claude/agents/
- Fallback settings control error handling behavior
- Complexity thresholds are configurable
</success_criteria>

<output>
After completion, create `.planning/phases/01-foundation-detection-routing/01-02-SUMMARY.md`
</output>