---
phase: 07.1-voltagent-verification-teams
plan: 02
type: execute
wave: 2
depends_on: ["07.1-01"]
files_modified:
  - /Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md
  - /Users/matte/Documents/workspace/get-shit-done/.planning/config.json
  - /Users/matte/Documents/workspace/get-shit-done/get-shit-done/docs/VERIFICATION.md
autonomous: true

must_haves:
  truths:
    - "Multiple verification specialists spawn for higher tier tasks"
    - "Tier 2 tasks get code-reviewer and qa-expert verification"
    - "Tier 3 tasks get full verification team in sequence"
    - "Verification can be disabled via config flag"
    - "Verification results from multiple specialists are aggregated"
  artifacts:
    - path: "/Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md"
      provides: "Multi-specialist verification chains"
      contains: "spawn_verification_team"
    - path: "/Users/matte/Documents/workspace/get-shit-done/.planning/config.json"
      provides: "Verification configuration"
      contains: "verification"
    - path: "/Users/matte/Documents/workspace/get-shit-done/get-shit-done/docs/VERIFICATION.md"
      provides: "Verification patterns documentation"
      min_lines: 100
  key_links:
    - from: "verification tier"
      to: "specialist list"
      via: "tier-to-specialists mapping"
      pattern: "Tier 2.*qa-expert"
    - from: "config.json"
      to: "verification behavior"
      via: "config check in execute-phase.md"
      pattern: "verification.*enabled"
---

<objective>
Implement multi-specialist verification teams and configuration options

Purpose: Enable tiered verification with multiple specialists for critical tasks
Output: Full verification team support with configurable behavior
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07.1-voltagent-verification-teams/07.1-RESEARCH.md
@.planning/phases/07.1-voltagent-verification-teams/07.1-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Generate tier-based specialist lists</name>
  <files>/Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</files>
  <action>
    Update execute-phase.md to generate the appropriate specialist list based on verification tier:

    1. Add specialist list generation logic after tier determination:
       ```markdown
       **Generate specialist list based on tier:**

       ```bash
       # Get specialists for tier from gsd-tools
       SPECIALISTS=$(echo "$TIER_INFO" | jq -r '.specialists[]')

       # Log the verification plan
       echo "Verification Tier $TIER detected - Specialists: $SPECIALISTS"
       ```
       ```

    2. Create mapping function for tier-to-specialists:
       ```bash
       # Tier-based specialist assignment
       case $TIER in
         1) SPECIALIST_LIST="code-reviewer" ;;
         2) SPECIALIST_LIST="code-reviewer qa-expert" ;;
         3) SPECIALIST_LIST="code-reviewer qa-expert principal-engineer" ;;
         *) SPECIALIST_LIST="" ;;
       esac
       ```

    3. Check specialist availability against available_agents.md:
       ```bash
       # Filter for available specialists only
       AVAILABLE_SPECIALISTS=""
       for SPECIALIST in $SPECIALIST_LIST; do
         if grep -q "^- \*\*${SPECIALIST}\*\*:" .planning/available_agents.md 2>/dev/null; then
           AVAILABLE_SPECIALISTS="$AVAILABLE_SPECIALISTS $SPECIALIST"
         else
           echo "Warning: ${SPECIALIST} not available" >&2
         fi
       done
       ```
  </action>
  <verify>grep -A 10 "Generate specialist list" /Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</verify>
  <done>Tier-based specialist lists are generated correctly</done>
</task>

<task type="auto">
  <name>Task 2: Implement multi-specialist spawning loop</name>
  <files>/Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</files>
  <action>
    Add the multi-specialist spawning loop with availability checks:

    1. Create the specialist iteration loop:
       ```markdown
       **Spawn verification specialists:**

       ```bash
       VERIFICATION_PASSED=true
       AGGREGATED_ISSUES=""

       # Process each specialist
       for SPECIALIST in $AVAILABLE_SPECIALISTS; do
         echo "Spawning ${SPECIALIST} for verification..."

         # Create context file for this specialist
         cat > /tmp/specialist-context.md << EOF
       Specialist: ${SPECIALIST}
       Previous findings: ${AGGREGATED_ISSUES:-None}
       EOF

         # Spawn the specialist
         RESULT=$(Task(
           subagent_type="${SPECIALIST}",
           model="claude-3-5-sonnet-latest",
           prompt="[specialist prompt with focus area]"
         ))

         # Parse result status
         STATUS=$(echo "$RESULT" | grep -o "status: [A-Z]*" | cut -d' ' -f2)

         # Handle failures
         if [ "$STATUS" = "FAIL" ]; then
           VERIFICATION_PASSED=false
           AGGREGATED_ISSUES="${AGGREGATED_ISSUES}\n## ${SPECIALIST}:\n${RESULT}"

           # For Tier 3, stop on first failure
           if [ "$TIER" = "3" ]; then
             echo "Tier 3 verification failed at ${SPECIALIST}, stopping chain"
             break
           fi
         fi
       done
       ```
       ```

    2. Add specialist-specific focus areas in prompts:
       ```markdown
       Specialist focus mapping:
       - code-reviewer: Code quality, patterns, security vulnerabilities
       - qa-expert: Test coverage, edge cases, quality metrics
       - principal-engineer: Architecture, scalability, production readiness
       ```

    3. Handle case where no specialists are available:
       ```bash
       if [ -z "$AVAILABLE_SPECIALISTS" ]; then
         echo "Warning: No verification specialists available, skipping verification"
         VERIFICATION_PASSED=true
       fi
       ```
  </action>
  <verify>grep -A 30 "Spawn verification specialists" /Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</verify>
  <done>Multi-specialist spawning loop processes all available specialists</done>
</task>

<task type="auto">
  <name>Task 3: Add result aggregation and decision logic</name>
  <files>/Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</files>
  <action>
    Implement result aggregation from multiple specialists:

    1. Create aggregation logic after specialist loop:
       ```markdown
       **Aggregate verification results:**

       ```bash
       # Determine overall verification status
       if [ "$VERIFICATION_PASSED" = "false" ]; then
         echo "VERIFICATION FAILED - Issues found:"
         echo "$AGGREGATED_ISSUES"

         # Ask user for decision
         echo "Verification failed. Options:"
         echo "1. Fix issues and retry task"
         echo "2. Continue anyway (acknowledge technical debt)"
         echo "3. Skip remaining tasks in this plan"
         read -p "Choice (1/2/3): " USER_CHOICE

         case $USER_CHOICE in
           1) RETRY_TASK=true ;;
           2) CONTINUE_WITH_DEBT=true ;;
           3) SKIP_PLAN=true ;;
         esac
       else
         echo "Verification PASSED - Task approved by all specialists"
       fi
       ```
       ```

    2. Log verification results to SUMMARY:
       ```markdown
       Add to SUMMARY.md:
       ```bash
       cat >> "${PHASE_DIR}/${PLAN_ID}-SUMMARY.md" << EOF

       ### Verification Results

       **Tier:** $TIER
       **Specialists:** $AVAILABLE_SPECIALISTS
       **Status:** ${VERIFICATION_PASSED}
       **Issues:** ${AGGREGATED_ISSUES:-None}
       EOF
       ```
       ```

    3. Handle different aggregation modes:
       - ALL_PASS: All specialists must pass
       - MAJORITY: Majority must pass (for Tier 2)
       - ADVISORY: Log warnings but don't block (for Tier 1)
  </action>
  <verify>grep -A 20 "Aggregate verification results" /Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</verify>
  <done>Verification results are aggregated and decisions are made</done>
</task>

<task type="auto">
  <name>Task 4: Add verification configuration support</name>
  <files>/Users/matte/Documents/workspace/get-shit-done/.planning/config.json</files>
  <action>
    Add verification configuration section to config.json:

    ```json
    "verification": {
      "enabled": true,
      "default_tier": 1,
      "tier_overrides": {
        "authentication": 3,
        "payments": 3,
        "database": 2
      },
      "sequential_for_tier_3": true,
      "required_specialists": ["code-reviewer"],
      "optional_specialists": ["qa-expert", "principal-engineer"],
      "fail_on_missing_required": false,
      "aggregate_findings": true
    }
    ```

    Configuration options:
    - `enabled`: Master switch for verification (default: true)
    - `default_tier`: Tier for unclassified tasks (default: 1)
    - `tier_overrides`: Force specific tiers for domain keywords (addresses VT-08 requirement for override capability)
    - `sequential_for_tier_3`: Run Tier 3 specialists in sequence vs parallel
    - `required_specialists`: Must be available or verification skips
    - `optional_specialists`: Use if available, skip if not
    - `fail_on_missing_required`: Block execution if required specialists missing
    - `aggregate_findings`: Combine results from multiple specialists

    Note: The `tier_overrides` field allows orchestrator to override tier decisions based on task domain, fulfilling VT-08 requirement.
  </action>
  <verify>jq '.verification' /Users/matte/Documents/workspace/get-shit-done/.planning/config.json</verify>
  <done>Verification configuration is added to config.json</done>
</task>

<task type="auto">
  <name>Task 5: Wire config reading into execute-phase workflow</name>
  <files>/Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</files>
  <action>
    Add configuration reading logic to execute-phase.md at the beginning of the verification section:

    1. Add config loading at the start of the "Verification (if tier > 0)" section (right after Wave completion step 4):
       ```markdown
       **Load verification configuration:**

       ```bash
       # Read verification config from config.json
       VERIFICATION_CONFIG=$(cat .planning/config.json 2>/dev/null | jq '.verification // {}')
       VERIFICATION_ENABLED=$(echo "$VERIFICATION_CONFIG" | jq -r '.enabled // true')
       DEFAULT_TIER=$(echo "$VERIFICATION_CONFIG" | jq -r '.default_tier // 1')
       TIER_OVERRIDES=$(echo "$VERIFICATION_CONFIG" | jq -r '.tier_overrides // {}')

       # Check if verification is enabled
       if [ "$VERIFICATION_ENABLED" = "false" ]; then
         echo "Verification disabled in config.json, skipping"
         continue
       fi

       # Check for environment override
       if [ "$SKIP_VERIFICATION" = "true" ]; then
         echo "SKIP_VERIFICATION set, bypassing verification"
         continue
       fi
       ```
       ```

    2. Add tier override checking (integrate with tier determination):
       ```bash
       # Check for config-based tier overrides
       for KEYWORD in authentication payments database security; do
         if echo "$TASK_DESCRIPTION" | grep -qi "$KEYWORD"; then
           OVERRIDE_TIER=$(echo "$TIER_OVERRIDES" | jq -r ".${KEYWORD} // 0")
           if [ "$OVERRIDE_TIER" -gt 0 ]; then
             echo "Config override: $KEYWORD tasks use Tier $OVERRIDE_TIER"
             TIER=$OVERRIDE_TIER
           fi
         fi
       done
       ```

    3. Add required vs optional specialist handling:
       ```bash
       # Check required specialists availability
       REQUIRED_SPECIALISTS=$(echo "$VERIFICATION_CONFIG" | jq -r '.required_specialists[]' 2>/dev/null)
       FAIL_ON_MISSING=$(echo "$VERIFICATION_CONFIG" | jq -r '.fail_on_missing_required // false')

       for SPECIALIST in $REQUIRED_SPECIALISTS; do
         if ! grep -q "^- \*\*${SPECIALIST}\*\*:" .planning/available_agents.md 2>/dev/null; then
           if [ "$FAIL_ON_MISSING" = "true" ]; then
             echo "ERROR: Required specialist ${SPECIALIST} not available"
             exit 1
           else
             echo "Warning: Required specialist ${SPECIALIST} not available, skipping verification"
             SKIP_VERIFICATION=true
           fi
         fi
       done
       ```
  </action>
  <verify>grep -A 15 "Load verification configuration" /Users/matte/Documents/workspace/get-shit-done/get-shit-done/workflows/execute-phase.md</verify>
  <done>Config reading is wired into execute-phase verification flow</done>
</task>

<task type="auto">
  <name>Task 6: Create verification documentation</name>
  <files>/Users/matte/Documents/workspace/get-shit-done/get-shit-done/docs/VERIFICATION.md</files>
  <action>
    Create comprehensive documentation for the verification system:

    # VoltAgent Verification Teams

    ## Overview
    Verification teams provide quality gates through multi-specialist review after task completion.

    ## Verification Tiers

    ### Tier 1 - Light Verification
    - **Specialists:** code-reviewer only
    - **Use for:** Simple changes, configs, documentation
    - **Focus:** Code quality, obvious issues, patterns

    ### Tier 2 - Standard Verification
    - **Specialists:** code-reviewer + qa-expert
    - **Use for:** Feature implementation, business logic
    - **Focus:** + Test coverage, edge cases, error handling

    ### Tier 3 - Deep Verification
    - **Specialists:** code-reviewer + qa-expert + principal-engineer
    - **Use for:** Security, payments, authentication, database changes
    - **Focus:** + Architecture, scalability, production readiness
    - **Execution:** Sequential chain - each specialist builds on prior findings

    ## Tier Classification

    Tasks are automatically classified based on keywords and patterns:
    - Security, auth, payment, crypto → Tier 3
    - API, business-logic, integration → Tier 2
    - Config, docs, UI styling → Tier 1

    Override in PLAN.md task frontmatter:
    ```yaml
    verification_tier: 3
    ```

    ## Configuration

    Configure in `.planning/config.json`:
    ```json
    {
      "verification": {
        "enabled": true,
        "default_tier": 1,
        "tier_overrides": {
          "authentication": 3,
          "payments": 3
        }
      }
    }
    ```

    The `tier_overrides` field allows you to force specific verification tiers for tasks containing certain keywords, providing override capability for orchestrator verification decisions (VT-08).

    Disable for specific execution:
    ```bash
    SKIP_VERIFICATION=true /gsd:execute-phase 07.1
    ```

    ## Specialist Responsibilities

    ### code-reviewer
    - Static analysis for vulnerabilities
    - Code pattern compliance
    - Performance implications
    - Technical debt identification

    ### qa-expert
    - Test coverage analysis
    - Edge case identification
    - Quality metrics assessment
    - Regression risk evaluation

    ### principal-engineer
    - Architecture alignment
    - Scalability verification
    - Production readiness
    - Error recovery patterns

    ## Verification Flow

    1. Task completes execution
    2. Orchestrator determines verification tier
    3. Spawns appropriate specialists (parallel or sequential)
    4. Each specialist reviews with their domain focus
    5. Results aggregated into decision
    6. PASS → task marked complete
    7. FAIL → issues reported, user decides next step

    ## Graceful Degradation

    When specialists unavailable:
    - Required specialists missing → Skip verification with warning
    - Optional specialists missing → Continue with available
    - No specialists available → Log warning, mark task complete

    ## Result Aggregation

    Multiple specialist findings are combined:
    - FAIL from any specialist → Overall FAIL
    - All PASS with some WARNING → Overall WARNING
    - All PASS → Overall PASS

    Priority: Security > Functionality > Performance > Style

    ## Override Capabilities

    The verification system supports multiple override mechanisms:

    1. **Task-level override:** Set `verification_tier` in PLAN.md task frontmatter
    2. **Domain-based override:** Configure `tier_overrides` in config.json for keyword-based tier assignment
    3. **Execution-level override:** Set `SKIP_VERIFICATION=true` environment variable
    4. **Global toggle:** Set `verification.enabled: false` in config.json

    These overrides fulfill requirement VT-08 for orchestrator verification decision control.

    ## Examples

    ### Tier 3 Sequential Chain
    ```
    Task: Implement JWT authentication
    1. code-reviewer → Finds SQL injection risk → FAIL
    2. Task sent back for fixes
    3. After fix, verification restarts
    4. code-reviewer → PASS
    5. qa-expert → Missing rate limit tests → WARNING
    6. principal-engineer → Needs refresh token rotation → FAIL
    7. Overall: FAIL (must fix principal's findings)
    ```

    ### Tier 2 Parallel Verification
    ```
    Task: Add user profile API
    1. code-reviewer + qa-expert spawn in parallel
    2. code-reviewer → PASS with style suggestions
    3. qa-expert → WARNING: Consider edge case tests
    4. Overall: WARNING (logged but task proceeds)
    ```
  </action>
  <verify>wc -l /Users/matte/Documents/workspace/get-shit-done/get-shit-done/docs/VERIFICATION.md | awk '{print $1}'</verify>
  <done>Verification system is fully documented with patterns and examples</done>
</task>

</tasks>

<verification>
- Multi-specialist verification teams spawn based on tier
- Tier 2 gets code-reviewer + qa-expert
- Tier 3 gets full sequential verification chain
- Verification configurable via config.json with override capabilities
- Configuration is read and applied in execute-phase.md
- Documentation explains patterns, usage, and override mechanisms
</verification>

<success_criteria>
- Tier 2 tasks spawn both code-reviewer and qa-expert
- Tier 3 tasks run sequential verification chain
- Verification can be disabled via config
- Multiple specialist results are aggregated correctly
- Config reading is properly integrated in execute-phase.md
- VERIFICATION.md provides clear usage patterns
</success_criteria>

<output>
After completion, create `.planning/phases/07.1-voltagent-verification-teams/07.1-02-SUMMARY.md`
</output>