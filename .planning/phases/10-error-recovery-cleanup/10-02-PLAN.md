---
phase: 10-error-recovery-cleanup
plan: 02
type: execute
wave: 2
depends_on: [10-01]
files_modified: [agents/gsd-executor.md, get-shit-done/references/specialist-delegation.md]
autonomous: true
user_setup: []

must_haves:
  truths:
    - "gsd-executor no longer contains broken Task() invocation code"
    - "Documentation clearly explains orchestrator-only delegation"
    - "Error recovery patterns are documented for future reference"
  artifacts:
    - path: "agents/gsd-executor.md"
      provides: "Clean executor without Task() code"
      not_contains: "Task\\("
    - path: "get-shit-done/references/specialist-delegation.md"
      provides: "Complete delegation and error recovery documentation"
      min_lines: 50
  key_links:
    - from: "gsd-executor.md"
      to: "orchestrator note"
      via: "documentation explaining why Task() was removed"
      pattern: "orchestrator.*handles.*delegation"
---

<objective>
Remove broken Task() delegation code from gsd-executor and document the complete specialist delegation architecture.

Purpose: Clean up technical debt and ensure future maintainers understand the delegation flow
Output: Clean gsd-executor.md and comprehensive delegation documentation
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/10-error-recovery-cleanup/10-RESEARCH.md
@.planning/phases/10-error-recovery-cleanup/10-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove broken Task() delegation from gsd-executor</name>
  <files>agents/gsd-executor.md</files>
  <action>
    Remove the broken Task() invocation code from gsd-executor.md:

    1. Locate lines 1480-1495 (the Task() invocation for specialist delegation)
    2. Delete the entire block including:
       - The Task() call starting at line 1483
       - The surrounding context setup
       - Any variable assignments related to SPECIALIST_OUTPUT

    3. Replace with a clear comment explaining the removal:
       ```
       # Specialist delegation removed - orchestrator handles all Task() spawning
       # Subagents lack Task tool access (architectural constraint)
       # See: get-shit-done/references/specialist-delegation.md
       ```

    4. Ensure any code that referenced SPECIALIST_OUTPUT is also cleaned up
    5. Verify the file still has valid markdown/bash syntax after removal

    Context: The Task() tool is only available to orchestrators (main Claude instance), not to subagents. This code was attempting something architecturally impossible and causes the "classifyHandoffIfNeeded is not defined" error.
  </action>
  <verify>! grep -q "Task(" agents/gsd-executor.md && grep -q "orchestrator handles all Task" agents/gsd-executor.md</verify>
  <done>Task() invocation removed from gsd-executor.md with explanatory comment</done>
</task>

<task type="auto">
  <name>Task 2: Create comprehensive specialist delegation reference</name>
  <files>get-shit-done/references/specialist-delegation.md</files>
  <action>
    Create a new reference document explaining the complete specialist delegation architecture:

    1. Architecture Overview
       - Why orchestrator-only delegation (Task tool constraint)
       - Flow: Planner → Orchestrator → Specialist → Result parsing
       - Decision points and fallback mechanisms

    2. Implementation Details
       - How planner assigns specialists (keyword matching)
       - How orchestrator parses specialist fields from PLAN.md
       - Validation and fallback logic (three-tier system from Phase 8)
       - Timeout and checkpoint mechanisms (from Plan 10-01)

    3. Error Recovery Patterns
       - Timeout handling (5-minute default, SIGKILL escalation)
       - Checkpoint/rollback for failed executions
       - Structured error logging:
         * Inline logging to stderr for immediate feedback (execute-phase.md)
         * Structured JSONL logging via gsd-tools log-specialist-error command
       - Partial result salvage strategies

    4. Configuration
       - config.json verification settings
       - Environment variables (DEBUG, SPECIALIST_TIMEOUT, SKIP_VERIFICATION)
       - Available specialists in available_agents.md

    5. Troubleshooting Guide
       - Common issues and solutions
       - Debug mode usage
       - Error log analysis
       - Manual checkpoint cleanup

    Include code examples from the actual implementation in execute-phase.md.
  </action>
  <verify>test -f get-shit-done/references/specialist-delegation.md && wc -l get-shit-done/references/specialist-delegation.md | awk '{print ($1 >= 50)}'</verify>
  <done>Comprehensive specialist delegation reference created with 50+ lines</done>
</task>

<task type="auto">
  <name>Task 3: Update gsd-executor documentation section</name>
  <files>agents/gsd-executor.md</files>
  <action>
    Update the documentation section of gsd-executor.md to reflect the new architecture:

    1. Find the section that explains specialist delegation (if it exists)
    2. Update or add a section explaining:
       - gsd-executor is a pure task executor (no delegation capability)
       - Specialist delegation handled exclusively by orchestrator
       - Fallback role: executes tasks when specialist unavailable

    3. Add to the "Constraints" or "Limitations" section:
       - Cannot invoke Task() tool (subagent limitation)
       - Cannot spawn other agents
       - Receives all context via initial prompt

    4. Update any examples that show delegation to remove those patterns

    This ensures the documentation matches the actual capabilities and prevents future confusion about why Task() was removed.
  </action>
  <verify>grep -A5 "orchestrator.*delegat" agents/gsd-executor.md</verify>
  <done>gsd-executor documentation updated to reflect orchestrator-only delegation</done>
</task>

</tasks>

<verification>
1. Confirm gsd-executor.md no longer contains any Task() invocations
2. Verify specialist-delegation.md provides clear guidance on the architecture
3. Test that gsd-executor still functions correctly for direct task execution
4. Check that all documentation is consistent with the new architecture
</verification>

<success_criteria>
- Broken Task() code completely removed from gsd-executor.md
- Clear documentation explains why delegation happens at orchestrator level
- Future maintainers understand the architectural constraints
- Error recovery patterns documented for reference
</success_criteria>

<output>
After completion, create `.planning/phases/10-error-recovery-cleanup/10-02-SUMMARY.md`
</output>