---
phase: 03-integration-wiring-delegation
plan: 02
type: execute
wave: 1
depends_on: []
files_modified: [agents/gsd-executor.md]
autonomous: true

must_haves:
  truths:
    - "Git commits include Co-authored-by trailer when task delegated to specialist"
    - "GitHub/GitLab parse co-authorship and display specialist attribution"
    - "SUMMARY.md frontmatter contains specialist usage metadata"
    - "Specialist usage metadata includes task number, specialist name, reason for selection"
  artifacts:
    - path: "agents/gsd-executor.md"
      provides: "Co-authored-by trailer logic in task_commit_protocol"
      contains: "Co-authored-by:.*specialist@voltagent"
      min_lines: 15
    - path: "agents/gsd-executor.md"
      provides: "Specialist metadata tracking in summary_creation"
      contains: "specialist-usage:"
      min_lines: 25
  key_links:
    - from: "task_commit_protocol section"
      to: "ROUTE_ACTION variable"
      via: "Conditional Co-authored-by trailer when delegate"
      pattern: "if.*ROUTE_ACTION.*delegate"
    - from: "summary_creation section"
      to: "specialist usage tracking"
      via: "Frontmatter specialist-usage array"
      pattern: "specialist-usage:.*task:.*name:"
    - from: "git commit message"
      to: "Git trailers"
      via: "Blank line before Co-authored-by"
      pattern: "\\n\\nCo-authored-by:"
---

<objective>
Add specialist attribution to git commits and SUMMARY.md metadata. When tasks are delegated, commits include Co-authored-by trailers following Git standard format, and SUMMARY.md documents which specialists contributed and why.

Purpose: Provides observability into specialist usage at two levels: (1) git blame/log shows specialist co-authorship for code attribution, (2) SUMMARY.md frontmatter enables delegation pattern analysis across phases.

Output: Commits with properly formatted Co-authored-by trailers when delegated, SUMMARY.md with specialist-usage frontmatter field documenting delegation decisions.
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-integration-wiring-delegation/03-RESEARCH.md

# Research findings on co-authorship and metadata
# See: RESEARCH.md sections "Pattern 2: Co-Authored Commit Attribution" and "Pattern 3: SUMMARY.md Specialist Metadata"

# Implementation target
@agents/gsd-executor.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add Co-authored-by trailer to task commits when delegated</name>
  <files>agents/gsd-executor.md</files>
  <action>
Enhance the <task_commit_protocol> section (lines 1595-1626) to include Co-authored-by trailer when task was delegated to specialist. Git trailers are standard since Git 2.0, parsed by GitHub/GitLab for attribution.

Implementation requirements:
1. After task completion, check ROUTE_ACTION variable (set during routing decision)
2. If ROUTE_ACTION = "delegate":
   - Build COAUTHOR_TRAILER="Co-authored-by: ${SPECIALIST} <specialist@voltagent>"
   - Email domain "specialist@voltagent" identifies VoltAgent specialists
3. If ROUTE_ACTION = "direct":
   - Set COAUTHOR_TRAILER="" (empty, no trailer)
4. Modify commit message format to include trailer:
   ```bash
   git commit -m "${COMMIT_TYPE}(${PHASE}-${PLAN}): ${TASK_NAME}

   - ${KEY_CHANGE_1}
   - ${KEY_CHANGE_2}
   ${COAUTHOR_TRAILER}"
   ```

CRITICAL formatting requirements (from GitHub official documentation):
- Blank line REQUIRED between commit body and trailer (two consecutive newlines)
- Exact format: "Co-authored-by: Name <email>" (capital C, hyphenated)
- If COAUTHOR_TRAILER is empty, blank line collapses (no trailing whitespace)
- Do NOT add blank line when no trailer (creates malformed commit message)

Best practice: Use heredoc for commit message construction to handle newlines correctly:
```bash
if [ "$ROUTE_ACTION" = "delegate" ]; then
  git commit -m "$(cat <<EOF
${COMMIT_TYPE}(${PHASE}-${PLAN}): ${TASK_NAME}

- ${KEY_CHANGE_1}
- ${KEY_CHANGE_2}

Co-authored-by: ${SPECIALIST} <specialist@voltagent>
EOF
)"
else
  git commit -m "${COMMIT_TYPE}(${PHASE}-${PLAN}): ${TASK_NAME}

- ${KEY_CHANGE_1}
- ${KEY_CHANGE_2}"
fi
```

Add comment explaining trailer format and GitHub/GitLab parsing.
  </action>
  <verify>
1. grep 'Co-authored-by:' agents/gsd-executor.md confirms trailer logic present
2. grep 'specialist@voltagent' agents/gsd-executor.md confirms email domain
3. Documentation explains blank line requirement
4. Conditional logic checks ROUTE_ACTION before adding trailer
  </verify>
  <done>
task_commit_protocol section includes Co-authored-by trailer logic. When delegated, commits include "Co-authored-by: ${SPECIALIST} <specialist@voltagent>" with proper blank line formatting. When direct, no trailer added.
  </done>
</task>

<task type="auto">
  <name>Task 2: Track specialist usage metadata during task execution</name>
  <files>agents/gsd-executor.md</files>
  <action>
Add specialist metadata tracking in the execute_tasks flow to capture delegation decisions for SUMMARY.md. Track task number, specialist name, reason (from ROUTE_DETAIL), and duration for each delegated task.

Implementation requirements:
1. Initialize tracking arrays at start of execute_tasks:
   ```bash
   SPECIALIST_TASKS=()     # Array of task numbers delegated
   SPECIALIST_NAMES=()     # Array of specialist names
   SPECIALIST_REASONS=()   # Array of reasons (from routing decision)
   SPECIALIST_DURATIONS=() # Array of task durations
   DIRECT_TASK_COUNT=0     # Counter for direct executions
   ```

2. After each task completion, record metadata:
   ```bash
   TASK_END=$(date +%s)
   TASK_DURATION=$((TASK_END - TASK_START))

   if [ "$ROUTE_ACTION" = "delegate" ]; then
     SPECIALIST_TASKS+=("$TASK_NUM")
     SPECIALIST_NAMES+=("$SPECIALIST")
     # Extract reason from routing decision (format: "delegate:python-pro:Python domain")
     REASON=$(echo "$ROUTE_DECISION" | cut -d: -f3-)
     SPECIALIST_REASONS+=("$REASON")
     SPECIALIST_DURATIONS+=("${TASK_DURATION}s")
   else
     DIRECT_TASK_COUNT=$((DIRECT_TASK_COUNT + 1))
   fi
   ```

3. Make these variables available to summary_creation step (they'll be used in next task)

Add this tracking logic immediately after task commit, before moving to next task. Track start time at beginning of task execution.
  </action>
  <verify>
1. grep 'SPECIALIST_TASKS' agents/gsd-executor.md confirms array initialization
2. grep 'SPECIALIST_DURATIONS' agents/gsd-executor.md confirms duration tracking
3. Tracking code appears after task commit in execute_tasks flow
4. DIRECT_TASK_COUNT incremented for non-delegated tasks
  </verify>
  <done>
execute_tasks flow tracks specialist metadata in arrays (tasks, names, reasons, durations) and counts direct executions. Metadata captured after each task commit for use in SUMMARY.md generation.
  </done>
</task>

<task type="auto">
  <name>Task 3: Add specialist-usage frontmatter to SUMMARY.md generation</name>
  <files>agents/gsd-executor.md</files>
  <action>
Enhance <summary_creation> section (lines 1628-1661) to include specialist usage metadata in YAML frontmatter. Extend existing frontmatter structure with specialist-usage field, total counts, and delegation ratio.

Implementation requirements:
1. After existing frontmatter fields (phase, plan, subsystem, tags, etc.), add specialist metadata:
   ```yaml
   # Specialist delegation metadata (if any tasks delegated)
   specialist-usage:
     - task: ${SPECIALIST_TASKS[0]}
       name: ${SPECIALIST_NAMES[0]}
       reason: "${SPECIALIST_REASONS[0]}"
       duration: ${SPECIALIST_DURATIONS[0]}
     # ... repeat for each delegated task

   total-specialist-tasks: ${#SPECIALIST_TASKS[@]}
   total-direct-tasks: ${DIRECT_TASK_COUNT}
   delegation-ratio: ${DELEGATION_RATIO}%
   ```

2. Calculate delegation ratio:
   ```bash
   TOTAL_TASKS=$((${#SPECIALIST_TASKS[@]} + DIRECT_TASK_COUNT))
   if [ $TOTAL_TASKS -gt 0 ]; then
     DELEGATION_RATIO=$(( ${#SPECIALIST_TASKS[@]} * 100 / TOTAL_TASKS ))
   else
     DELEGATION_RATIO=0
   fi
   ```

3. Conditionally include specialist-usage section:
   - If ${#SPECIALIST_TASKS[@]} -eq 0: Omit specialist-usage, totals, and ratio fields entirely
   - If ${#SPECIALIST_TASKS[@]} -gt 0: Include full specialist metadata

4. Generate frontmatter using loop for specialist-usage array:
   ```bash
   if [ ${#SPECIALIST_TASKS[@]} -gt 0 ]; then
     echo "specialist-usage:" >> frontmatter.tmp
     for i in "${!SPECIALIST_TASKS[@]}"; do
       echo "  - task: ${SPECIALIST_TASKS[$i]}" >> frontmatter.tmp
       echo "    name: ${SPECIALIST_NAMES[$i]}" >> frontmatter.tmp
       echo "    reason: \"${SPECIALIST_REASONS[$i]}\"" >> frontmatter.tmp
       echo "    duration: ${SPECIALIST_DURATIONS[$i]}" >> frontmatter.tmp
     done
     echo "total-specialist-tasks: ${#SPECIALIST_TASKS[@]}" >> frontmatter.tmp
     echo "total-direct-tasks: ${DIRECT_TASK_COUNT}" >> frontmatter.tmp
     echo "delegation-ratio: ${DELEGATION_RATIO}%" >> frontmatter.tmp
   fi
   ```

Add this logic to the frontmatter generation section of summary_creation. Place after existing fields (decisions, metrics) and before closing "---".

Add documentation comment explaining specialist metadata schema for future reference.
  </action>
  <verify>
1. grep 'specialist-usage:' agents/gsd-executor.md confirms frontmatter field
2. grep 'delegation-ratio' agents/gsd-executor.md confirms ratio calculation
3. Conditional logic checks ${#SPECIALIST_TASKS[@]} before including metadata
4. Loop structure generates array entries for each delegated task
  </verify>
  <done>
summary_creation section generates specialist-usage frontmatter when tasks delegated. Includes task number, specialist name, reason, duration for each. Calculates delegation ratio. Omits fields when no delegation occurred.
  </done>
</task>

</tasks>

<verification>
**Commit attribution verification:**
1. Verify Co-authored-by trailer format matches Git standard (capital C, hyphenated)
2. Check blank line requirement documented and implemented
3. Confirm conditional logic (only when ROUTE_ACTION = "delegate")

**Metadata verification:**
1. Verify specialist tracking arrays initialized at execute_tasks start
2. Check metadata captured after each task commit
3. Confirm SUMMARY.md frontmatter includes specialist-usage when applicable
4. Verify delegation ratio calculation (percentage of delegated tasks)

**Edge cases:**
1. No delegation: SUMMARY.md omits specialist fields entirely
2. All tasks delegated: delegation-ratio shows 100%
3. Mixed delegation: specialist-usage lists only delegated tasks
</verification>

<success_criteria>
1. task_commit_protocol includes Co-authored-by trailer when ROUTE_ACTION = "delegate"
2. Co-authored-by format follows Git standard (blank line, exact capitalization, email domain)
3. execute_tasks tracks specialist metadata (task, name, reason, duration) in arrays
4. summary_creation generates specialist-usage frontmatter with full metadata
5. delegation-ratio calculated correctly (delegated / total tasks * 100)
6. specialist-usage section omitted when no tasks delegated (${#SPECIALIST_TASKS[@]} = 0)
</success_criteria>

<output>
After completion, create `.planning/phases/03-integration-wiring-delegation/03-02-SUMMARY.md`
</output>
